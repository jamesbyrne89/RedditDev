{"version":3,"file":"static/webpack/static\\development\\pages\\_app.js.e36a0c49814a061c6752.hot-update.js","sources":["webpack:///./pages/_app.tsx"],"sourcesContent":["import App, { Container } from 'next/app';\r\nimport axios from 'axios';\r\nimport { endpoints } from '../lib/subreddits';\r\nimport {\r\n  filterPostsCallback,\r\n  isAlreadyFavourite,\r\n  sortByNewest,\r\n} from '../lib/utils';\r\n\r\ninterface Props { loading: boolean, posts: Array }\r\n\r\nclass MyApp extends App<Props> {\r\n  state = { loading: true, posts: [], favourites: [] };\r\n  static async getInitialProps() {\r\n    const data = await axios.all(\r\n      Object.keys(endpoints).map(url => axios.get(endpoints[url])),\r\n    );\r\n    const cleaned: Array<{}> = data.reduce(\r\n      (acc: any, curr: any): Array<{}> => {\r\n        return [ ...curr.data.data.children, ...acc ];\r\n      },\r\n      [],\r\n    );\r\n    let filterFunc;\r\n    const postsSortedByNewest: Array<object> = cleaned.sort(sortByNewest);\r\n    const postsToDisplay = filterFunc\r\n      ? postsSortedByNewest.filter(filterFunc)\r\n      : postsSortedByNewest;\r\n\r\n    return { posts: postsToDisplay };\r\n  }\r\n\r\n  componentDidMount() {\r\n    localStorage.setItem('reddit-posts', JSON.stringify(this.props.posts));\r\n    const cachedFavourites: Array<{}> = JSON.parse(\r\n      localStorage.getItem('favourite-reddit-posts'),\r\n    ) ||\r\n      [];\r\n\r\n    this.setState({\r\n      loading: false,\r\n      posts: this.props.posts,\r\n      favourites: cachedFavourites,\r\n    });\r\n  }\r\n\r\n  filterPosts = (searchTerm = '') => {\r\n    const filtered = this.state.posts.filter(filterPostsCallback(searchTerm));\r\n    this.setState({ posts: filtered });\r\n  };\r\n\r\n  addToFavourites = postToAdd => {\r\n    if (\r\n      this.state.favourites.filter(isAlreadyFavourite(postToAdd)).length > 0\r\n    ) {\r\n      this.removeFromFavourites(postToAdd);\r\n    }\r\n    const newFavouritesList = [ ...this.state.favourites, postToAdd ];\r\n    this.setState({ favourites: newFavouritesList }, () => {\r\n      localStorage.setItem(\r\n        'favourite-reddit-posts',\r\n        JSON.stringify(this.state.favourites),\r\n      );\r\n    });\r\n  };\r\n\r\n  removeFromFavourites = postToRemove => {\r\n    const newFavouritesList = this.state.favourites.filter(\r\n      fav =>\r\n        postToRemove.data.title === fav.data.title &&\r\n          postToRemove.data.created_utc === fav.data.created_utc,\r\n    );\r\n    this.setState({ favourites: newFavouritesList }, () => {\r\n      localStorage.setItem(\r\n        'favourite-reddit-posts',\r\n        JSON.stringify(this.state.favourites),\r\n      );\r\n    });\r\n  };\r\n\r\n  render() {\r\n    const { Component, pageProps } = this.props;\r\n    return (\r\n      <Container>\r\n        <Component\r\n          posts={this.state.posts}\r\n          loading={this.state.loading}\r\n          onSearchSubmit={this.filterPosts}\r\n          onAddToFavourites={this.addToFavourites}\r\n          favourites={this.state.favourites}\r\n          {...pageProps}\r\n        />\r\n      </Container>\r\n    );\r\n  }\r\n}\r\n\r\nexport default MyApp;\r\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AAOA;;;;;;;;;;;;;;;;;;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAiCA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAIA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAGA;AAAA;AAAA;AACA;AAIA;AACA;AACA;;;;;;AA/CA;AACA;AACA;AAKA;AACA;AACA;AACA;AAHA;AAKA;;;AAoCA;AAAA;AAAA;AAAA;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AALA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAUA;;;;;;;;;;;;;AAhFA;AACA;AAAA;AACA;;AAFA;AAGA;AAEA;AACA;AAIA;AACA;AAIA;AAAA;AAAA;AACA;;;;;;;;;;;;;;;;;;AAnBA;AACA;AAqFA;;;;;;;;;;;;;;;;;;;;;;;A","sourceRoot":""}